---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/external-secrets.io/externalsecret_v1beta1.json
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: lldap-config
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    name: lldap-config-secret
    template:
      data:
        users.json: |
          [
            {
              "id": "{{ .LLDAP_USER_0_ID }}",
              "email": "{{ .LLDAP_USER_0_EMAIL }}",
              "password": "{{ .LLDAP_USER_0_PASS }}",
              "displayName": "{{ .LLDAP_USER_0_DNAME }}",
              "firstName": "{{ .LLDAP_USER_0_FNAME }}",
              "lastName": "{{ .LLDAP_USER_0_LNAME }}",
              "gravatar_avatar": "false"
            }
          ]
        group0.json: |
          {
            "name": "superusers"
          }
        group1.json: |
          {
            "name": "appusers"
          }

  dataFrom:
    - extract:
        key: lldap
---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/external-secrets.io/externalsecret_v1beta1.json
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: lldap-bootstrap
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    name: lldap-bootstrap-secret
    template:
      data:
        LLDAP_URL: "http://lldap:17170"
        LLDAP_ADMIN_USERNAME: "{{ .LLDAP_USER_ADMIN_DN }}"
        LLDAP_ADMIN_PASSWORD: "{{ .LLDAP_USER_ADMIN_PASS }}"
  dataFrom:
    - extract:
        key: lldap
